<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #bdc3c7;
        }
        
        .tab:last-child {
            border-right: none;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #d5dbdb;
        }
        
        .race-content {
            display: none;
        }
        
        .race-content.active {
            display: block;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .control-group select:focus, .control-group input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .horse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .horse-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #3498db;
        }
        
        .horse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        
        .horse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .horse-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .horse-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .mark-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .mark {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .final-mark {
            background: #e74c3c;
            color: white;
        }
        
        .investment-mark {
            background: #27ae60;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .comparison-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
        }
        
        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9rem;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .best-value {
            background: #d5f4e6 !important;
            font-weight: bold;
        }
        
        .worst-value {
            background: #fadbd8 !important;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .view-btn.active {
            background: #3498db;
            color: white;
        }
        
        .view-btn:not(.active) {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .file-upload {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .file-upload input {
            width: 100%;
            padding: 10px;
            border: 2px dashed #3498db;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .github-info {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .github-info a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .data-source {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‡ ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        
        <div class="github-info">
            <p>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: GitHub Repository | ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å¯¾å¿œ</p>
            <div class="data-source">
                GitHubã‹ã‚‰JSONãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥èª­ã¿è¾¼ã¿ã€è¤‡æ•°ãƒ¬ãƒ¼ã‚¹ã®è©³ç´°åˆ†æãŒå¯èƒ½ã§ã™
            </div>
        </div>
        
        <div class="file-upload">
            <input type="file" id="fileInput" accept=".json" multiple>
            <p>è¤‡æ•°ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¬ãƒ¼ã‚¹æ¯”è¼ƒãŒå¯èƒ½ã§ã™</p>
        </div>
        
        <div class="tabs" id="raceTabs">
            <button class="tab active" data-race="default">äº¬éƒ½1R</button>
        </div>
        
        <div class="race-content active" id="race-default">
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('cards')">ã‚«ãƒ¼ãƒ‰è¡¨ç¤º</button>
                <button class="view-btn" onclick="switchView('table')">ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º</button>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>ã‚½ãƒ¼ãƒˆåŸºæº–:</label>
                    <select id="sortBy">
                        <option value="horse_number">é¦¬ç•ª</option>
                        <option value="popularity">äººæ°—</option>
                        <option value="score_original">ã‚¹ã‚³ã‚¢</option>
                        <option value="pred_prob_won">å‹ç‡äºˆæ¸¬</option>
                        <option value="investment_rating">æŠ•è³‡è©•ä¾¡</option>
                    </select>
                    
                    <label>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</label>
                    <select id="filterBy">
                        <option value="all">å…¨ã¦</option>
                        <option value="top3">ä¸Šä½3é ­</option>
                        <option value="mark_good">â—â—‹å°</option>
                        <option value="investment_good">æŠ•è³‡å¦™å‘³ã‚ã‚Š</option>
                    </select>
                    
                    <label>æ¤œç´¢:</label>
                    <input type="text" id="searchHorse" placeholder="é¦¬åæ¤œç´¢">
                </div>
            </div>
            
            <div id="cardView" class="horse-grid"></div>
            <div id="tableView" class="comparison-table" style="display: none;"></div>
        </div>
    </div>

    <script>
        let raceData = {};
        let currentRace = 'default';
        let currentView = 'cards';
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿
        const defaultData = {
            "horses": [
                {
                    "horse_number": 4,
                    "name": "ãƒ¦ã‚­ãƒã‚¯ãƒ©ã‚¦ãƒ³",
                    "popularity": 1,
                    "track_aptitude": 2,
                    "score_original": 138.37,
                    "score_z": 1.19,
                    "pred_prob_won": 0.2,
                    "pred_prob_in_top2": 0.2,
                    "pred_prob_in_top3": 0.54,
                    "final_mark": "â—",
                    "ä¸Šã‚Š3Få¹³å‡": 39.3,
                    "Ave-3Få¹³å‡": 38.4,
                    "PCIå¹³å‡": 47.7,
                    "-3Få·®å¹³å‡": 0.2,
                    "æƒ³å®šè„šè³ª": "å…ˆè¡Œ",
                    "track_bias_aptitude_score": 94.5,
                    "investment_value_score": 100,
                    "total_investment_index": 95.3,
                    "investment_rating": 0.85,
                    "investment_mark": "â—"
                },
                {
                    "horse_number": 9,
                    "name": "ãƒŸãƒƒã‚­ãƒ¼ã‚³ãƒ³ãƒ‰ãƒ«",
                    "popularity": 4,
                    "track_aptitude": 2,
                    "score_original": 123.89,
                    "score_z": 0.49,
                    "pred_prob_won": 0.09,
                    "pred_prob_in_top2": 0.1,
                    "pred_prob_in_top3": 0.32,
                    "final_mark": "â–³",
                    "ä¸Šã‚Š3Få¹³å‡": 36.93,
                    "Ave-3Få¹³å‡": 37.03,
                    "PCIå¹³å‡": 50.27,
                    "-3Få·®å¹³å‡": 0.5,
                    "æƒ³å®šè„šè³ª": "å…ˆè¡Œ",
                    "track_bias_aptitude_score": 94.5,
                    "investment_value_score": 55.5,
                    "total_investment_index": 67.5,
                    "investment_rating": 0.678,
                    "investment_mark": "â—‹"
                },
                {
                    "horse_number": 5,
                    "name": "ãƒ™ãƒ©ã‚¸ã‚ªã‚¬ãƒ«ãƒ•",
                    "popularity": 3,
                    "track_aptitude": 0,
                    "score_original": 127.25,
                    "score_z": 0.65,
                    "pred_prob_won": 0.11,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.35,
                    "final_mark": "â—‹",
                    "ä¸Šã‚Š3Få¹³å‡": 36.37,
                    "Ave-3Få¹³å‡": 37.36,
                    "PCIå¹³å‡": 52.73,
                    "-3Få·®å¹³å‡": 0.65,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 64.2,
                    "total_investment_index": 55.6,
                    "investment_rating": 0.66,
                    "investment_mark": "â–³"
                },
                {
                    "horse_number": 11,
                    "name": "ãƒã‚¤ã‚¯ã‚ªãƒªãƒ†ã‚£",
                    "popularity": 2,
                    "track_aptitude": 2,
                    "score_original": 127.87,
                    "score_z": 0.68,
                    "pred_prob_won": 0.1,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.34,
                    "final_mark": "â–³",
                    "ä¸Šã‚Š3Få¹³å‡": 37.55,
                    "Ave-3Få¹³å‡": 38.08,
                    "PCIå¹³å‡": 51.55,
                    "-3Få·®å¹³å‡": 1.03,
                    "æƒ³å®šè„šè³ª": "å¾Œæ–¹",
                    "track_bias_aptitude_score": 12.0,
                    "investment_value_score": 72.3,
                    "total_investment_index": 53.1,
                    "investment_rating": 0.487,
                    "investment_mark": "â–³"
                },
                {
                    "horse_number": 1,
                    "name": "ãƒŸãƒ¦ãƒ³ã‚¬ãƒ¼",
                    "popularity": 9,
                    "track_aptitude": 0,
                    "score_original": 115.05,
                    "score_z": 0.06,
                    "pred_prob_won": 0.04,
                    "pred_prob_in_top2": 0.06,
                    "pred_prob_in_top3": 0.16,
                    "final_mark": "Ã—",
                    "ä¸Šã‚Š3Få¹³å‡": 39.69,
                    "Ave-3Få¹³å‡": 37.02,
                    "PCIå¹³å‡": 43.43,
                    "-3Få·®å¹³å‡": 0.97,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 23.4,
                    "total_investment_index": 30.2,
                    "investment_rating": 0.204,
                    "investment_mark": "â˜†"
                },
                {
                    "horse_number": 6,
                    "name": "ãƒ’ã‚·ã‚«ãƒªãƒŠãƒ³",
                    "popularity": 5,
                    "track_aptitude": 1,
                    "score_original": 116.96,
                    "score_z": 0.15,
                    "pred_prob_won": 0.05,
                    "pred_prob_in_top2": 0.07,
                    "pred_prob_in_top3": 0.19,
                    "final_mark": "â˜†",
                    "ä¸Šã‚Š3Få¹³å‡": 36.1,
                    "Ave-3Få¹³å‡": 37.57,
                    "PCIå¹³å‡": 54.14,
                    "-3Få·®å¹³å‡": 0.82,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": 38.9,
                    "total_investment_index": 41.3,
                    "investment_rating": 0.193,
                    "investment_mark": "â˜†"
                },
                {
                    "horse_number": 7,
                    "name": "ã‚«ãƒ³ã‚¿ã‚«ãƒŠãƒªãƒ¼ãƒˆ",
                    "popularity": 7,
                    "track_aptitude": 1,
                    "score_original": 111.07,
                    "score_z": -0.13,
                    "pred_prob_won": 0.03,
                    "pred_prob_in_top2": 0.06,
                    "pred_prob_in_top3": 0.14,
                    "final_mark": "Ã—",
                    "ä¸Šã‚Š3Få¹³å‡": 39.83,
                    "Ave-3Få¹³å‡": 37.83,
                    "PCIå¹³å‡": 44.97,
                    "-3Få·®å¹³å‡": 0.97,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": 25.1,
                    "total_investment_index": 32.5,
                    "investment_rating": 0.012,
                    "investment_mark": "Ã—"
                },
                {
                    "horse_number": 10,
                    "name": "ã‚«ãƒ¼ãƒªãƒ³ãƒãƒ¼ãƒˆ",
                    "popularity": 8,
                    "track_aptitude": 2,
                    "score_original": 107.58,
                    "score_z": -0.3,
                    "pred_prob_won": 0.02,
                    "pred_prob_in_top2": 0.03,
                    "pred_prob_in_top3": 0.09,
                    "final_mark": "æ¶ˆ",
                    "ä¸Šã‚Š3Få¹³å‡": 36.9,
                    "Ave-3Få¹³å‡": 37.01,
                    "PCIå¹³å‡": 50.3,
                    "-3Få·®å¹³å‡": 0.5,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 47.8,
                    "investment_value_score": 13.7,
                    "total_investment_index": 27.1,
                    "investment_rating": -0.278,
                    "investment_mark": "Ã—Ã—"
                },
                {
                    "horse_number": 8,
                    "name": "ãƒ€ã‚ºãƒ©ãƒ¼",
                    "popularity": 6,
                    "track_aptitude": 0,
                    "score_original": 62.62,
                    "score_z": -2.48,
                    "pred_prob_won": 0.01,
                    "pred_prob_in_top2": 0.02,
                    "pred_prob_in_top3": 0.05,
                    "final_mark": "æ¶ˆ",
                    "ä¸Šã‚Š3Få¹³å‡": 0,
                    "Ave-3Få¹³å‡": 0,
                    "PCIå¹³å‡": 0,
                    "-3Få·®å¹³å‡": 0,
                    "æƒ³å®šè„šè³ª": "ä¸æ˜",
                    "track_bias_aptitude_score": null,
                    "investment_value_score": 2.9,
                    "total_investment_index": null,
                    "investment_rating": -0.487,
                    "investment_mark": "Ã—Ã—"
                },
                {
                    "horse_number": 3,
                    "name": "ã‚¢ã‚¤ãƒ³ãƒ›ãƒ«ãƒ³",
                    "popularity": 10,
                    "track_aptitude": 0,
                    "score_original": 95.15,
                    "score_z": -0.9,
                    "pred_prob_won": 0.01,
                    "pred_prob_in_top2": 0.03,
                    "pred_prob_in_top3": 0.06,
                    "final_mark": "æ¶ˆ",
                    "ä¸Šã‚Š3Få¹³å‡": 38.97,
                    "Ave-3Få¹³å‡": 37.07,
                    "PCIå¹³å‡": 45.47,
                    "-3Få·®å¹³å‡": 1.03,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 1,
                    "total_investment_index": 15.1,
                    "investment_rating": -0.503,
                    "investment_mark": "Ã—Ã—"
                },
                {
                    "horse_number": 2,
                    "name": "ãƒ¡ã‚¤ã‚·ãƒ§ã‚¦ãƒ©ã‚¤ã‚º",
                    "popularity": 0,
                    "track_aptitude": 1,
                    "score_original": 126.58,
                    "score_z": 0.62,
                    "pred_prob_won": 0.1,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.35,
                    "final_mark": "â–²",
                    "ä¸Šã‚Š3Få¹³å‡": 38.35,
                    "Ave-3Få¹³å‡": 37.83,
                    "PCIå¹³å‡": 48.77,
                    "-3Få·®å¹³å‡": 1.23,
                    "æƒ³å®šè„šè³ª": "ä¸­å›£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": null,
                    "total_investment_index": null,
                    "investment_rating": null,
                    "investment_mark": "ä¸æ˜"
                }
            ]
        };
        
        raceData['default'] = defaultData;
        
        // æ•°å€¤ã®é«˜ä½åˆ¤å®šè¨­å®š
        const valueTypes = {
            'popularity': 'lower', // äººæ°—ã¯ä½ã„æ–¹ãŒè‰¯ã„
            'ä¸Šã‚Š3Få¹³å‡': 'lower',
            'Ave-3Få¹³å‡': 'lower',
            '-3Få·®å¹³å‡': 'zero', // 0ã«è¿‘ã„æ–¹ãŒè‰¯ã„ï¼ˆå‰ã‚’èµ°ã‚‹ï¼‰
            'PCIå¹³å‡': 'distance_from_50', // 50ã‹ã‚‰ã®è·é›¢ã§è„šè³ªåˆ¤å®š
            'track_aptitude': 'higher',
            'score_original': 'higher',
            'score_z': 'higher',
            'pred_prob_won': 'higher',
            'pred_prob_in_top2': 'higher',
            'pred_prob_in_top3': 'higher',
            'track_bias_aptitude_score': 'higher',
            'investment_value_score': 'higher',
            'total_investment_index': 'higher',
            'investment_rating': 'higher' // æŠ•è³‡ä¾¡å€¤ã®é‡è¦æŒ‡æ¨™
        };
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'cards') {
                document.getElementById('cardView').style.display = 'grid';
                document.getElementById('tableView').style.display = 'none';
            } else {
                document.getElementById('cardView').style.display = 'none';
                document.getElementById('tableView').style.display = 'block';
                renderTable();
            }
        }
        
        function formatValue(value, key) {
            if (value === null || value === undefined) return '-';
            if (typeof value === 'number') {
                if (key.includes('prob_')) return (value * 100).toFixed(1) + '%';
                if (key === 'PCIå¹³å‡') {
                    const pciType = value < 45 ? 'å‰åŠå‹' : value > 55 ? 'å¾ŒåŠå‹' : 'æŒä¹…å‹';
                    return `${value.toFixed(1)} (${pciType})`;
                }
                if (key === '-3Få·®å¹³å‡') {
                    const position = Math.abs(value) < 0.5 ? 'å‰å¯„ã‚Š' : 'ä¸­å¾Œæ–¹';
                    return `${value.toFixed(2)} (${position})`;
                }
                if (key === 'investment_rating') {
                    const rating = value > 0.7 ? 'é«˜' : value > 0.4 ? 'ä¸­' : 'ä½';
                    return `${value.toFixed(3)} (${rating})`;
                }
                return value.toFixed(2);
            }
            return value;
        }
        
        function renderCards() {
            const horses = getFilteredHorses();
            const cardView = document.getElementById('cardView');
            
            cardView.innerHTML = horses.map(horse => `
                <div class="horse-card">
                    <div class="horse-header">
                        <div class="horse-name">${horse.name}</div>
                        <div class="horse-number">${horse.horse_number}</div>
                    </div>
                    <div class="mark-section">
                        <div class="mark final-mark">æœ¬å‘½: ${horse.final_mark}</div>
                        <div class="mark investment-mark">æŠ•è³‡: ${horse.investment_mark}</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">äººæ°—</div>
                            <div class="stat-value">${horse.popularity || '-'}ä½</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                            <div class="stat-value">${formatValue(horse.score_original)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å‹ç‡äºˆæ¸¬</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">3ç€å†…ç‡</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ä¸Šã‚Š3F</div>
                            <div class="stat-value">${formatValue(horse['ä¸Šã‚Š3Få¹³å‡'])}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">-3Få·® (ä½ç½®)</div>
                            <div class="stat-value">${formatValue(horse['-3Få·®å¹³å‡'], '-3Få·®å¹³å‡')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">PCI (è„šè³ª)</div>
                            <div class="stat-value">${formatValue(horse['PCIå¹³å‡'], 'PCIå¹³å‡')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">é©æ€§ã‚¹ã‚³ã‚¢</div>
                            <div class="stat-value">${formatValue(horse.track_bias_aptitude_score)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æŠ•è³‡è©•ä¾¡â˜…</div>
                            <div class="stat-value">${formatValue(horse.investment_rating, 'investment_rating')}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderTable() {
            const horses = getFilteredHorses();
            const tableView = document.getElementById('tableView');
            
            const numericKeys = Object.keys(horses[0]).filter(key => 
                typeof horses[0][key] === 'number' && key !== 'horse_number'
            );
            
            // å„åˆ—ã®æœ€é«˜å€¤ãƒ»æœ€ä½å€¤ã‚’è¨ˆç®—
            const stats = {};
            numericKeys.forEach(key => {
                const values = horses.map(h => h[key]).filter(v => v !== null && v !== undefined);
                if (values.length > 0) {
                    stats[key] = {
                        min: Math.min(...values),
                        max: Math.max(...values)
                    };
                }
            });
            
            function getCellClass(value, key) {
                if (!stats[key] || value === null || value === undefined) return '';
                
                if (valueTypes[key] === 'higher') {
                    return value === stats[key].max ? 'best-value' : 
                           value === stats[key].min ? 'worst-value' : '';
                } else if (valueTypes[key] === 'lower') {
                    return value === stats[key].min ? 'best-value' : 
                           value === stats[key].max ? 'worst-value' : '';
                } else if (valueTypes[key] === 'zero') {
                    // 0ã«æœ€ã‚‚è¿‘ã„å€¤ãŒæœ€è‰¯
                    const distances = horses.map(h => Math.abs(h[key] || 0)).filter(d => !isNaN(d));
                    const minDistance = Math.min(...distances);
                    return Math.abs(value) === minDistance ? 'best-value' : '';
                } else if (valueTypes[key] === 'distance_from_50') {
                    // PCIå¹³å‡ã¯50ã‹ã‚‰ã®è·é›¢ã§è„šè³ªã‚’ç¤ºã™ã®ã§ã€æœ€è‰¯/æœ€æ‚ªã®æ¦‚å¿µã¯é©ç”¨ã—ãªã„
                    return '';
                }
                return '';
            }
            
            tableView.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>é¦¬ç•ª</th>
                            <th>é¦¬å</th>
                            <th>äººæ°—</th>
                            <th>æœ¬å‘½å°</th>
                            <th>æŠ•è³‡å°</th>
                            <th>ã‚¹ã‚³ã‚¢</th>
                            <th>å‹ç‡äºˆæ¸¬</th>
                            <th>3ç€å†…ç‡</th>
                            <th>ä¸Šã‚Š3F</th>
                            <th>Ave-3F</th>
                            <th>-3Få·®</th>
                            <th>PCI(è„šè³ª)</th>
                            <th>é©æ€§ã‚¹ã‚³ã‚¢</th>
                            <th>æŠ•è³‡è©•ä¾¡â˜…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${horses.map(horse => `
                            <tr>
                                <td>${horse.horse_number}</td>
                                <td><strong>${horse.name}</strong></td>
                                <td class="${getCellClass(horse.popularity, 'popularity')}">${horse.popularity || '-'}</td>
                                <td>${horse.final_mark}</td>
                                <td>${horse.investment_mark}</td>
                                <td class="${getCellClass(horse.score_original, 'score_original')}">${formatValue(horse.score_original)}</td>
                                <td class="${getCellClass(horse.pred_prob_won, 'pred_prob_won')}">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</td>
                                <td class="${getCellClass(horse.pred_prob_in_top3, 'pred_prob_in_top3')}">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</td>
                                <td class="${getCellClass(horse['ä¸Šã‚Š3Få¹³å‡'], 'ä¸Šã‚Š3Få¹³å‡')}">${formatValue(horse['ä¸Šã‚Š3Få¹³å‡'])}</td>
                                <td class="${getCellClass(horse['Ave-3Få¹³å‡'], 'Ave-3Få¹³å‡')}">${formatValue(horse['Ave-3Få¹³å‡'])}</td>
                                <td class="${getCellClass(horse['-3Få·®å¹³å‡'], '-3Få·®å¹³å‡')}">${formatValue(horse['-3Få·®å¹³å‡'], '-3Få·®å¹³å‡')}</td>
                                <td class="${getCellClass(horse['PCIå¹³å‡'], 'PCIå¹³å‡')}">${formatValue(horse['PCIå¹³å‡'], 'PCIå¹³å‡')}</td>
                                <td class="${getCellClass(horse.track_bias_aptitude_score, 'track_bias_aptitude_score')}">${formatValue(horse.track_bias_aptitude_score)}</td>
                                <td class="${getCellClass(horse.investment_rating, 'investment_rating')}">${formatValue(horse.investment_rating, 'investment_rating')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function getFilteredHorses() {
            let horses = [...raceData[currentRace].horses];
            
            // ã‚½ãƒ¼ãƒˆ
            const sortBy = document.getElementById('sortBy').value;
            horses.sort((a, b) => {
                const aVal = a[sortBy] || 0;
                const bVal = b[sortBy] || 0;
                
                if (valueTypes[sortBy] === 'lower') {
                    return aVal - bVal;
                } else if (valueTypes[sortBy] === 'zero') {
                    return Math.abs(aVal) - Math.abs(bVal);
                } else {
                    return bVal - aVal; // higher
                }
            });
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const filterBy = document.getElementById('filterBy').value;
            if (filterBy === 'top3') {
                horses = horses.filter(h => h.popularity <= 3);
            } else if (filterBy === 'mark_good') {
                horses = horses.filter(h => ['â—', 'â—‹'].includes(h.final_mark));
            } else if (filterBy === 'investment_good') {
                horses = horses.filter(h => h.investment_rating > 0.5);
            }
            
            // æ¤œç´¢
            const searchTerm = document.getElementById('searchHorse').value.toLowerCase();
            if (searchTerm) {
                horses = horses.filter(h => h.name.toLowerCase().includes(searchTerm));
            }
            
            return horses;
        }
        
        function setupEventListeners() {
            document.getElementById('sortBy').addEventListener('change', renderCurrentView);
            document.getElementById('filterBy').addEventListener('change', renderCurrentView);
            document.getElementById('searchHorse').addEventListener('input', renderCurrentView);
            
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        }
        
        function renderCurrentView() {
            if (currentView === 'cards') {
                renderCards();
            } else {
                renderTable();
            }
        }
        
        function handleFileUpload(event) {
            const files = event.target.files;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        const raceName = file.name.replace('_enhanced.json', '').replace('.json', '');
                        
                        raceData[raceName] = data;
                        addRaceTab(raceName);
                    } catch (error) {
                        alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + error.message);
                    }
                };
                reader.readAsText(file);
            });
        }
        
        function addRaceTab(raceName) {
            const tabsContainer = document.getElementById('raceTabs');
            
            // ã‚¿ãƒ–ãŒæ—¢ã«å­˜åœ¨ã—ãªã„å ´åˆã®ã¿è¿½åŠ 
            if (!document.querySelector(`[data-race="${raceName}"]`)) {
                const tabButton = document.createElement('button');
                tabButton.className = 'tab';
                tabButton.textContent = raceName;
                tabButton.setAttribute('data-race', raceName);
                tabButton.onclick = () => switchRace(raceName);
                
                tabsContainer.appendChild(tabButton);
            }
        }
        
        function switchRace(raceName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-race="${raceName}"]`).classList.add('active');
            
            currentRace = raceName;
            renderCurrentView();
        }
        
        // åˆæœŸåŒ–
        setupEventListeners();
        renderCards();
    </script>
</body>
</html>
