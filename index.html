<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á´∂È¶¨„Éá„Éº„ÇøÊØîËºÉ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #bdc3c7;
        }
        
        .tab:last-child {
            border-right: none;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #d5dbdb;
        }
        
        .race-content {
            display: none;
        }
        
        .race-content.active {
            display: block;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .control-group select:focus, .control-group input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .horse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .horse-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #3498db;
        }
        
        .horse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        
        .horse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .horse-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .horse-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .mark-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .mark {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .final-mark {
            background: #e74c3c;
            color: white;
        }
        
        .investment-mark {
            background: #27ae60;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .comparison-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
        }
        
        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9rem;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .best-value {
            background: #d5f4e6 !important;
            font-weight: bold;
        }
        
        .worst-value {
            background: #fadbd8 !important;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .view-btn.active {
            background: #3498db;
            color: white;
        }
        
        .view-btn:not(.active) {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .file-upload {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .file-upload input {
            width: 100%;
            padding: 10px;
            border: 2px dashed #3498db;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .github-info {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .github-info a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .data-source {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèá Á´∂È¶¨„Éá„Éº„ÇøÊØîËºÉ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
        
        <div class="github-info">
            <p>üìä „Éá„Éº„Çø„ÇΩ„Éº„Çπ: GitHub Repository | üîÑ „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞ÂØæÂøú</p>
            <div class="data-source">
                GitHub„Åã„ÇâJSON„Éá„Éº„Çø„ÇíÁõ¥Êé•Ë™≠„ÅøËæº„Åø„ÄÅË§áÊï∞„É¨„Éº„Çπ„ÅÆË©≥Á¥∞ÂàÜÊûê„ÅåÂèØËÉΩ„Åß„Åô
            </div>
        </div>
        
        <div class="file-upload">
            <input type="file" id="fileInput" accept=".json" multiple>
            <p>Ë§áÊï∞„ÅÆJSON„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„É¨„Éº„ÇπÊØîËºÉ„ÅåÂèØËÉΩ„Åß„Åô</p>
        </div>
        
        <div class="tabs" id="raceTabs">
            <button class="tab active" data-race="default">‰∫¨ÈÉΩ1R</button>
        </div>
        
        <div class="race-content active" id="race-default">
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('cards')">„Ç´„Éº„ÉâË°®Á§∫</button>
                <button class="view-btn" onclick="switchView('table')">„ÉÜ„Éº„Éñ„É´Ë°®Á§∫</button>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>„ÇΩ„Éº„ÉàÂü∫Ê∫ñ:</label>
                    <select id="sortBy">
                        <option value="horse_number">È¶¨Áï™</option>
                        <option value="popularity">‰∫∫Ê∞ó</option>
                        <option value="score_original">„Çπ„Ç≥„Ç¢</option>
                        <option value="pred_prob_won">ÂãùÁéá‰∫àÊ∏¨</option>
                        <option value="investment_rating">ÊäïË≥áË©ï‰æ°</option>
                    </select>
                    
                    <label>„Éï„Ç£„É´„Çø„Éº:</label>
                    <select id="filterBy">
                        <option value="all">ÂÖ®„Å¶</option>
                        <option value="top3">‰∏ä‰Ωç3È†≠</option>
                        <option value="mark_good">‚óé‚óãÂç∞</option>
                        <option value="investment_good">ÊäïË≥áÂ¶ôÂë≥„ÅÇ„Çä</option>
                    </select>
                    
                    <label>Ê§úÁ¥¢:</label>
                    <input type="text" id="searchHorse" placeholder="È¶¨ÂêçÊ§úÁ¥¢">
                </div>
            </div>
            
            <div id="cardView" class="horse-grid"></div>
            <div id="tableView" class="comparison-table" style="display: none;"></div>
        </div>
    </div>

    <script>
        let raceData = {};
        let currentRace = 'default';
        let currentView = 'cards';
        
        // „Éá„Éï„Ç©„É´„Éà„Éá„Éº„Çø
        const defaultData = {
            "horses": [
                {
                    "horse_number": 4,
                    "name": "„É¶„Ç≠„Éé„ÇØ„É©„Ç¶„É≥",
                    "popularity": 1,
                    "track_aptitude": 2,
                    "score_original": 138.37,
                    "score_z": 1.19,
                    "pred_prob_won": 0.2,
                    "pred_prob_in_top2": 0.2,
                    "pred_prob_in_top3": 0.54,
                    "final_mark": "‚óé",
                    "‰∏ä„Çä3FÂπ≥Âùá": 39.3,
                    "Ave-3FÂπ≥Âùá": 38.4,
                    "PCIÂπ≥Âùá": 47.7,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.2,
                    "ÊÉ≥ÂÆöËÑöË≥™": "ÂÖàË°å",
                    "track_bias_aptitude_score": 94.5,
                    "investment_value_score": 100,
                    "total_investment_index": 95.3,
                    "investment_rating": 0.85,
                    "investment_mark": "‚óé"
                },
                {
                    "horse_number": 9,
                    "name": "„Éü„ÉÉ„Ç≠„Éº„Ç≥„É≥„Éâ„É´",
                    "popularity": 4,
                    "track_aptitude": 2,
                    "score_original": 123.89,
                    "score_z": 0.49,
                    "pred_prob_won": 0.09,
                    "pred_prob_in_top2": 0.1,
                    "pred_prob_in_top3": 0.32,
                    "final_mark": "‚ñ≥",
                    "‰∏ä„Çä3FÂπ≥Âùá": 36.93,
                    "Ave-3FÂπ≥Âùá": 37.03,
                    "PCIÂπ≥Âùá": 50.27,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.5,
                    "ÊÉ≥ÂÆöËÑöË≥™": "ÂÖàË°å",
                    "track_bias_aptitude_score": 94.5,
                    "investment_value_score": 55.5,
                    "total_investment_index": 67.5,
                    "investment_rating": 0.678,
                    "investment_mark": "‚óã"
                },
                {
                    "horse_number": 5,
                    "name": "„Éô„É©„Ç∏„Ç™„Ç¨„É´„Éï",
                    "popularity": 3,
                    "track_aptitude": 0,
                    "score_original": 127.25,
                    "score_z": 0.65,
                    "pred_prob_won": 0.11,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.35,
                    "final_mark": "‚óã",
                    "‰∏ä„Çä3FÂπ≥Âùá": 36.37,
                    "Ave-3FÂπ≥Âùá": 37.36,
                    "PCIÂπ≥Âùá": 52.73,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.65,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 64.2,
                    "total_investment_index": 55.6,
                    "investment_rating": 0.66,
                    "investment_mark": "‚ñ≥"
                },
                {
                    "horse_number": 11,
                    "name": "„Éè„Ç§„ÇØ„Ç™„É™„ÉÜ„Ç£",
                    "popularity": 2,
                    "track_aptitude": 2,
                    "score_original": 127.87,
                    "score_z": 0.68,
                    "pred_prob_won": 0.1,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.34,
                    "final_mark": "‚ñ≥",
                    "‰∏ä„Çä3FÂπ≥Âùá": 37.55,
                    "Ave-3FÂπ≥Âùá": 38.08,
                    "PCIÂπ≥Âùá": 51.55,
                    "-3FÂ∑ÆÂπ≥Âùá": 1.03,
                    "ÊÉ≥ÂÆöËÑöË≥™": "ÂæåÊñπ",
                    "track_bias_aptitude_score": 12.0,
                    "investment_value_score": 72.3,
                    "total_investment_index": 53.1,
                    "investment_rating": 0.487,
                    "investment_mark": "‚ñ≥"
                },
                {
                    "horse_number": 1,
                    "name": "„Éü„É¶„É≥„Ç¨„Éº",
                    "popularity": 9,
                    "track_aptitude": 0,
                    "score_original": 115.05,
                    "score_z": 0.06,
                    "pred_prob_won": 0.04,
                    "pred_prob_in_top2": 0.06,
                    "pred_prob_in_top3": 0.16,
                    "final_mark": "√ó",
                    "‰∏ä„Çä3FÂπ≥Âùá": 39.69,
                    "Ave-3FÂπ≥Âùá": 37.02,
                    "PCIÂπ≥Âùá": 43.43,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.97,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 23.4,
                    "total_investment_index": 30.2,
                    "investment_rating": 0.204,
                    "investment_mark": "‚òÜ"
                },
                {
                    "horse_number": 6,
                    "name": "„Éí„Ç∑„Ç´„É™„Éä„É≥",
                    "popularity": 5,
                    "track_aptitude": 1,
                    "score_original": 116.96,
                    "score_z": 0.15,
                    "pred_prob_won": 0.05,
                    "pred_prob_in_top2": 0.07,
                    "pred_prob_in_top3": 0.19,
                    "final_mark": "‚òÜ",
                    "‰∏ä„Çä3FÂπ≥Âùá": 36.1,
                    "Ave-3FÂπ≥Âùá": 37.57,
                    "PCIÂπ≥Âùá": 54.14,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.82,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": 38.9,
                    "total_investment_index": 41.3,
                    "investment_rating": 0.193,
                    "investment_mark": "‚òÜ"
                },
                {
                    "horse_number": 7,
                    "name": "„Ç´„É≥„Çø„Ç´„Éä„É™„Éº„Éà",
                    "popularity": 7,
                    "track_aptitude": 1,
                    "score_original": 111.07,
                    "score_z": -0.13,
                    "pred_prob_won": 0.03,
                    "pred_prob_in_top2": 0.06,
                    "pred_prob_in_top3": 0.14,
                    "final_mark": "√ó",
                    "‰∏ä„Çä3FÂπ≥Âùá": 39.83,
                    "Ave-3FÂπ≥Âùá": 37.83,
                    "PCIÂπ≥Âùá": 44.97,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.97,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": 25.1,
                    "total_investment_index": 32.5,
                    "investment_rating": 0.012,
                    "investment_mark": "√ó"
                },
                {
                    "horse_number": 10,
                    "name": "„Ç´„Éº„É™„É≥„Éè„Éº„Éà",
                    "popularity": 8,
                    "track_aptitude": 2,
                    "score_original": 107.58,
                    "score_z": -0.3,
                    "pred_prob_won": 0.02,
                    "pred_prob_in_top2": 0.03,
                    "pred_prob_in_top3": 0.09,
                    "final_mark": "Ê∂à",
                    "‰∏ä„Çä3FÂπ≥Âùá": 36.9,
                    "Ave-3FÂπ≥Âùá": 37.01,
                    "PCIÂπ≥Âùá": 50.3,
                    "-3FÂ∑ÆÂπ≥Âùá": 0.5,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 47.8,
                    "investment_value_score": 13.7,
                    "total_investment_index": 27.1,
                    "investment_rating": -0.278,
                    "investment_mark": "√ó√ó"
                },
                {
                    "horse_number": 8,
                    "name": "„ÉÄ„Ç∫„É©„Éº",
                    "popularity": 6,
                    "track_aptitude": 0,
                    "score_original": 62.62,
                    "score_z": -2.48,
                    "pred_prob_won": 0.01,
                    "pred_prob_in_top2": 0.02,
                    "pred_prob_in_top3": 0.05,
                    "final_mark": "Ê∂à",
                    "‰∏ä„Çä3FÂπ≥Âùá": 0,
                    "Ave-3FÂπ≥Âùá": 0,
                    "PCIÂπ≥Âùá": 0,
                    "-3FÂ∑ÆÂπ≥Âùá": 0,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏çÊòé",
                    "track_bias_aptitude_score": null,
                    "investment_value_score": 2.9,
                    "total_investment_index": null,
                    "investment_rating": -0.487,
                    "investment_mark": "√ó√ó"
                },
                {
                    "horse_number": 3,
                    "name": "„Ç¢„Ç§„É≥„Éõ„É´„É≥",
                    "popularity": 10,
                    "track_aptitude": 0,
                    "score_original": 95.15,
                    "score_z": -0.9,
                    "pred_prob_won": 0.01,
                    "pred_prob_in_top2": 0.03,
                    "pred_prob_in_top3": 0.06,
                    "final_mark": "Ê∂à",
                    "‰∏ä„Çä3FÂπ≥Âùá": 38.97,
                    "Ave-3FÂπ≥Âùá": 37.07,
                    "PCIÂπ≥Âùá": 45.47,
                    "-3FÂ∑ÆÂπ≥Âùá": 1.03,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 36.8,
                    "investment_value_score": 1,
                    "total_investment_index": 15.1,
                    "investment_rating": -0.503,
                    "investment_mark": "√ó√ó"
                },
                {
                    "horse_number": 2,
                    "name": "„É°„Ç§„Ç∑„Éß„Ç¶„É©„Ç§„Ç∫",
                    "popularity": 0,
                    "track_aptitude": 1,
                    "score_original": 126.58,
                    "score_z": 0.62,
                    "pred_prob_won": 0.1,
                    "pred_prob_in_top2": 0.12,
                    "pred_prob_in_top3": 0.35,
                    "final_mark": "‚ñ≤",
                    "‰∏ä„Çä3FÂπ≥Âùá": 38.35,
                    "Ave-3FÂπ≥Âùá": 37.83,
                    "PCIÂπ≥Âùá": 48.77,
                    "-3FÂ∑ÆÂπ≥Âùá": 1.23,
                    "ÊÉ≥ÂÆöËÑöË≥™": "‰∏≠Âõ£",
                    "track_bias_aptitude_score": 42.3,
                    "investment_value_score": null,
                    "total_investment_index": null,
                    "investment_rating": null,
                    "investment_mark": "‰∏çÊòé"
                }
            ]
        };
        
        raceData['default'] = defaultData;
        
        // Êï∞ÂÄ§„ÅÆÈ´ò‰ΩéÂà§ÂÆöË®≠ÂÆö
        const valueTypes = {
            'popularity': 'lower', // ‰∫∫Ê∞ó„ÅØ‰Ωé„ÅÑÊñπ„ÅåËâØ„ÅÑ
            '‰∏ä„Çä3FÂπ≥Âùá': 'lower',
            'Ave-3FÂπ≥Âùá': 'lower',
            '-3FÂ∑ÆÂπ≥Âùá': 'zero', // 0„Å´Ëøë„ÅÑÊñπ„ÅåËâØ„ÅÑÔºàÂâç„ÇíËµ∞„ÇãÔºâ
            'PCIÂπ≥Âùá': 'distance_from_50', // 50„Åã„Çâ„ÅÆË∑ùÈõ¢„ÅßËÑöË≥™Âà§ÂÆö
            'track_aptitude': 'higher',
            'score_original': 'higher',
            'score_z': 'higher',
            'pred_prob_won': 'higher',
            'pred_prob_in_top2': 'higher',
            'pred_prob_in_top3': 'higher',
            'track_bias_aptitude_score': 'higher',
            'investment_value_score': 'higher',
            'total_investment_index': 'higher',
            'investment_rating': 'higher' // ÊäïË≥á‰æ°ÂÄ§„ÅÆÈáçË¶ÅÊåáÊ®ô
        };
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'cards') {
                document.getElementById('cardView').style.display = 'grid';
                document.getElementById('tableView').style.display = 'none';
            } else {
                document.getElementById('cardView').style.display = 'none';
                document.getElementById('tableView').style.display = 'block';
                renderTable();
            }
        }
        
        function formatValue(value, key) {
            if (value === null || value === undefined) return '-';
            if (typeof value === 'number') {
                if (key.includes('prob_')) return (value * 100).toFixed(1) + '%';
                if (key === 'PCIÂπ≥Âùá') {
                    const pciType = value < 45 ? 'ÂâçÂçäÂûã' : value > 55 ? 'ÂæåÂçäÂûã' : 'ÊåÅ‰πÖÂûã';
                    return `${value.toFixed(1)} (${pciType})`;
                }
                if (key === '-3FÂ∑ÆÂπ≥Âùá') {
                    const position = Math.abs(value) < 0.5 ? 'ÂâçÂØÑ„Çä' : '‰∏≠ÂæåÊñπ';
                    return `${value.toFixed(2)} (${position})`;
                }
                if (key === 'investment_rating') {
                    const rating = value > 0.7 ? 'È´ò' : value > 0.4 ? '‰∏≠' : '‰Ωé';
                    return `${value.toFixed(3)} (${rating})`;
                }
                return value.toFixed(2);
            }
            return value;
        }
        
        function renderCards() {
            const horses = getFilteredHorses();
            const cardView = document.getElementById('cardView');
            
            cardView.innerHTML = horses.map(horse => `
                <div class="horse-card">
                    <div class="horse-header">
                        <div class="horse-name">${horse.name}</div>
                        <div class="horse-number">${horse.horse_number}</div>
                    </div>
                    <div class="mark-section">
                        <div class="mark final-mark">Êú¨ÂëΩ: ${horse.final_mark}</div>
                        <div class="mark investment-mark">ÊäïË≥á: ${horse.investment_mark}</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">‰∫∫Ê∞ó</div>
                            <div class="stat-value">${horse.popularity || '-'}‰Ωç</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">„Çπ„Ç≥„Ç¢</div>
                            <div class="stat-value">${formatValue(horse.score_original)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÂãùÁéá‰∫àÊ∏¨</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">3ÁùÄÂÜÖÁéá</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">‰∏ä„Çä3F</div>
                            <div class="stat-value">${formatValue(horse['‰∏ä„Çä3FÂπ≥Âùá'])}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">-3FÂ∑Æ (‰ΩçÁΩÆ)</div>
                            <div class="stat-value">${formatValue(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">PCI (ËÑöË≥™)</div>
                            <div class="stat-value">${formatValue(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÈÅ©ÊÄß„Çπ„Ç≥„Ç¢</div>
                            <div class="stat-value">${formatValue(horse.track_bias_aptitude_score)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÊäïË≥áË©ï‰æ°‚òÖ</div>
                            <div class="stat-value">${formatValue(horse.investment_rating, 'investment_rating')}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderTable() {
            const horses = getFilteredHorses();
            const tableView = document.getElementById('tableView');
            
            const numericKeys = Object.keys(horses[0]).filter(key => 
                typeof horses[0][key] === 'number' && key !== 'horse_number'
            );
            
            // ÂêÑÂàó„ÅÆÊúÄÈ´òÂÄ§„ÉªÊúÄ‰ΩéÂÄ§„ÇíË®àÁÆó
            const stats = {};
            numericKeys.forEach(key => {
                const values = horses.map(h => h[key]).filter(v => v !== null && v !== undefined);
                if (values.length > 0) {
                    stats[key] = {
                        min: Math.min(...values),
                        max: Math.max(...values)
                    };
                }
            });
            
            function getCellClass(value, key) {
                if (!stats[key] || value === null || value === undefined) return '';
                
                if (valueTypes[key] === 'higher') {
                    return value === stats[key].max ? 'best-value' : 
                           value === stats[key].min ? 'worst-value' : '';
                } else if (valueTypes[key] === 'lower') {
                    return value === stats[key].min ? 'best-value' : 
                           value === stats[key].max ? 'worst-value' : '';
                } else if (valueTypes[key] === 'zero') {
                    // 0„Å´ÊúÄ„ÇÇËøë„ÅÑÂÄ§„ÅåÊúÄËâØ
                    const distances = horses.map(h => Math.abs(h[key] || 0)).filter(d => !isNaN(d));
                    const minDistance = Math.min(...distances);
                    return Math.abs(value) === minDistance ? 'best-value' : '';
                } else if (valueTypes[key] === 'distance_from_50') {
                    // PCIÂπ≥Âùá„ÅØ50„Åã„Çâ„ÅÆË∑ùÈõ¢„ÅßËÑöË≥™„ÇíÁ§∫„Åô„ÅÆ„Åß„ÄÅÊúÄËâØ/ÊúÄÊÇ™„ÅÆÊ¶ÇÂøµ„ÅØÈÅ©Áî®„Åó„Å™„ÅÑ
                    return '';
                }
                return '';
            }
            
            tableView.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>È¶¨Áï™</th>
                            <th>È¶¨Âêç</th>
                            <th>‰∫∫Ê∞ó</th>
                            <th>Êú¨ÂëΩÂç∞</th>
                            <th>ÊäïË≥áÂç∞</th>
                            <th>„Çπ„Ç≥„Ç¢</th>
                            <th>ÂãùÁéá‰∫àÊ∏¨</th>
                            <th>3ÁùÄÂÜÖÁéá</th>
                            <th>‰∏ä„Çä3F</th>
                            <th>Ave-3F</th>
                            <th>-3FÂ∑Æ</th>
                            <th>PCI(ËÑöË≥™)</th>
                            <th>ÈÅ©ÊÄß„Çπ„Ç≥„Ç¢</th>
                            <th>ÊäïË≥áË©ï‰æ°‚òÖ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${horses.map(horse => `
                            <tr>
                                <td>${horse.horse_number}</td>
                                <td><strong>${horse.name}</strong></td>
                                <td class="${getCellClass(horse.popularity, 'popularity')}">${horse.popularity || '-'}</td>
                                <td>${horse.final_mark}</td>
                                <td>${horse.investment_mark}</td>
                                <td class="${getCellClass(horse.score_original, 'score_original')}">${formatValue(horse.score_original)}</td>
                                <td class="${getCellClass(horse.pred_prob_won, 'pred_prob_won')}">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</td>
                                <td class="${getCellClass(horse.pred_prob_in_top3, 'pred_prob_in_top3')}">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</td>
                                <td class="${getCellClass(horse['‰∏ä„Çä3FÂπ≥Âùá'], '‰∏ä„Çä3FÂπ≥Âùá')}">${formatValue(horse['‰∏ä„Çä3FÂπ≥Âùá'])}</td>
                                <td class="${getCellClass(horse['Ave-3FÂπ≥Âùá'], 'Ave-3FÂπ≥Âùá')}">${formatValue(horse['Ave-3FÂπ≥Âùá'])}</td>
                                <td class="${getCellClass(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}">${formatValue(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}</td>
                                <td class="${getCellClass(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}">${formatValue(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}</td>
                                <td class="${getCellClass(horse.track_bias_aptitude_score, 'track_bias_aptitude_score')}">${formatValue(horse.track_bias_aptitude_score)}</td>
                                <td class="${getCellClass(horse.investment_rating, 'investment_rating')}">${formatValue(horse.investment_rating, 'investment_rating')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function getFilteredHorses() {
            let horses = [...raceData[currentRace].horses];
            
            // „ÇΩ„Éº„Éà
            const sortBy = document.getElementById('sortBy').value;
            horses.sort((a, b) => {
                const aVal = a[sortBy] || 0;
                const bVal = b[sortBy] || 0;
                
                if (valueTypes[sortBy] === 'lower') {
                    return aVal - bVal;
                } else if (valueTypes[sortBy] === 'zero') {
                    return Math.abs(aVal) - Math.abs(bVal);
                } else {
                    return bVal - aVal; // higher
                }
            });
            
            // „Éï„Ç£„É´„Çø„Éº
            const filterBy = document.getElementById('filterBy').value;
            if (filterBy === 'top3') {
                horses = horses.filter(h => h.popularity <= 3);
            } else if (filterBy === 'mark_good') {
                horses = horses.filter(h => ['‚óé', '‚óã'].includes(h.final_mark));
            } else if (filterBy === 'investment_good') {
                horses = horses.filter(h => h.investment_rating > 0.5);
            }
            
            // Ê§úÁ¥¢
            const searchTerm = document.getElementById('searchHorse').value.toLowerCase();
            if (searchTerm) {
                horses = horses.filter(h => h.name.toLowerCase().includes(searchTerm));
            }
            
            return horses;
        }
        
        function setupEventListeners() {
            document.getElementById('sortBy').addEventListener('change', renderCurrentView);
            document.getElementById('filterBy').addEventListener('change', renderCurrentView);
            document.getElementById('searchHorse').addEventListener('input', renderCurrentView);
            
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        }
        
        function renderCurrentView() {
            if (currentView === 'cards') {
                renderCards();
            } else {
                renderTable();
            }
        }
        
        function handleFileUpload(event) {
            const files = event.target.files;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        const raceName = file.name.replace('_enhanced.json', '').replace('.json', '');
                        
                        raceData[raceName] = data;
                        addRaceTab(raceName);
                    } catch (error) {
                        alert('JSON„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ' + error.message);
                    }
                };
                reader.readAsText(file);
            });
        }
        
        function addRaceTab(raceName) {
            const tabsContainer = document.getElementById('raceTabs');
            
            // „Çø„Éñ„ÅåÊó¢„Å´Â≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøËøΩÂä†
            if (!document.querySelector(`[data-race="${raceName}"]`)) {
                const tabButton = document.createElement('button');
                tabButton.className = 'tab';
                tabButton.textContent = raceName;
                tabButton.setAttribute('data-race', raceName);
                tabButton.onclick = () => switchRace(raceName);
                
                tabsContainer.appendChild(tabButton);
            }
        }
        
        function switchRace(raceName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-race="${raceName}"]`).classList.add('active');
            
            currentRace = raceName;
            renderCurrentView();
        }
        
        // ÂàùÊúüÂåñ
        setupEventListeners();
        renderCards();
    </script>
</body>
</html>
