<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á´∂È¶¨„Éá„Éº„ÇøÊØîËºÉ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .race-selector {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .race-selector label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .race-selector select {
            padding: 10px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
            background: white;
        }
        
        .race-selector select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        #raceCount {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .race-content {
            display: none;
        }
        
        .race-content.active {
            display: block;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .control-group select:focus, .control-group input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .horse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .horse-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #3498db;
        }
        
        .horse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        
        .horse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .horse-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .horse-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .mark-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .mark {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .final-mark {
            background: #e74c3c;
            color: white;
        }
        
        .investment-mark {
            background: #27ae60;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .comparison-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
        }
        
        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9rem;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .best-value {
            background: #d5f4e6 !important;
            font-weight: bold;
        }
        
        .worst-value {
            background: #fadbd8 !important;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .view-btn.active {
            background: #3498db;
            color: white;
        }
        
        .view-btn:not(.active) {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .file-upload {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .file-upload input {
            width: 100%;
            padding: 10px;
            border: 2px dashed #3498db;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .github-info {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .github-info a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .data-source {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèá Á´∂È¶¨„Éá„Éº„ÇøÊØîËºÉ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
        
        <div class="github-info">
            <p>üìä „Éá„Éº„Çø„ÇΩ„Éº„Çπ: GitHub Repository | üîÑ „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞ÂØæÂøú</p>
            <div class="data-source">
                GitHub„Åã„ÇâJSON„Éá„Éº„Çø„ÇíÁõ¥Êé•Ë™≠„ÅøËæº„Åø„ÄÅË§áÊï∞„É¨„Éº„Çπ„ÅÆË©≥Á¥∞ÂàÜÊûê„ÅåÂèØËÉΩ„Åß„Åô
            </div>
        </div>
        
        <div class="file-upload">
            <div id="loadingStatus">üì° GitHub„Åã„Çâ„É¨„Éº„Çπ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            <div id="loadedRaces" style="display:none;">
                <p>‚úÖ Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü„Åó„Åü„É¨„Éº„Çπ:</p>
                <div id="racesList"></div>
            </div>
        </div>
        
        <div class="race-selector">
            <label for="raceSelect">üèá „É¨„Éº„ÇπÈÅ∏Êäû:</label>
            <select id="raceSelect">
                <option value="">„É¨„Éº„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
            </select>
            <span id="raceCount"></span>
        </div>
        
        <div class="race-content active" id="race-content">
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('cards')">„Ç´„Éº„ÉâË°®Á§∫</button>
                <button class="view-btn" onclick="switchView('table')">„ÉÜ„Éº„Éñ„É´Ë°®Á§∫</button>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>„ÇΩ„Éº„ÉàÂü∫Ê∫ñ:</label>
                    <select id="sortBy">
                        <option value="horse_number">È¶¨Áï™</option>
                        <option value="popularity">‰∫∫Ê∞ó</option>
                        <option value="score_original">„Çπ„Ç≥„Ç¢</option>
                        <option value="pred_prob_won">ÂãùÁéá‰∫àÊ∏¨</option>
                        <option value="investment_rating">ÊäïË≥áË©ï‰æ°</option>
                    </select>
                    
                    <label>„Éï„Ç£„É´„Çø„Éº:</label>
                    <select id="filterBy">
                        <option value="all">ÂÖ®„Å¶</option>
                        <option value="top3">‰∏ä‰Ωç3È†≠</option>
                        <option value="mark_good">‚óé‚óãÂç∞</option>
                        <option value="investment_good">ÊäïË≥áÂ¶ôÂë≥„ÅÇ„Çä</option>
                    </select>
                    
                    <label>Ê§úÁ¥¢:</label>
                    <input type="text" id="searchHorse" placeholder="È¶¨ÂêçÊ§úÁ¥¢">
                </div>
            </div>
            
            <div id="cardView" class="horse-grid"></div>
            <div id="tableView" class="comparison-table" style="display: none;"></div>
        </div>
    </div>

    <script>
        let raceData = {};
        let currentRace = null;
        let currentView = 'cards';
        
        // Ëá™ÂãïË™≠„ÅøËæº„ÅøÂØæË±°„ÅÆ„Éï„Ç°„Ç§„É´„É™„Çπ„Éà
        const raceFiles = [];
        const venues = ['‰∫¨ÈÉΩ', 'Êñ∞ÊΩü', 'Êù±‰∫¨'];
        venues.forEach(venue => {
            for (let r = 1; r <= 12; r++) {
                raceFiles.push(`${venue}${r}R_enhanced.json`);
            }
        });
        
        // GitHub„Åã„ÇâËá™ÂãïË™≠„ÅøËæº„Åø
        async function loadRaceData() {
            const loadingStatus = document.getElementById('loadingStatus');
            const loadedRaces = document.getElementById('loadedRaces');
            const racesList = document.getElementById('racesList');
            const raceSelect = document.getElementById('raceSelect');
            const raceCount = document.getElementById('raceCount');
            
            let loadedCount = 0;
            const loadedRaceNames = [];
            
            for (const file of raceFiles) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const data = await response.json();
                        const raceName = file.replace('_enhanced.json', '');
                        
                        raceData[raceName] = data;
                        loadedRaceNames.push(raceName);
                        loadedCount++;
                        
                        // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Å´ËøΩÂä†
                        const option = document.createElement('option');
                        option.value = raceName;
                        option.textContent = raceName;
                        raceSelect.appendChild(option);
                        
                        // ÊúÄÂàù„ÅÆ„É¨„Éº„Çπ„ÇíË°®Á§∫
                        if (loadedCount === 1) {
                            currentRace = raceName;
                            raceSelect.value = raceName;
                            renderCurrentView();
                        }
                    }
                } catch (error) {
                    // „Éï„Ç°„Ç§„É´„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                    console.log(`${file} „Çí„Çπ„Ç≠„ÉÉ„Éó: ${error.message}`);
                }
            }
            
            // Ë™≠„ÅøËæº„ÅøÁµêÊûú„ÇíË°®Á§∫
            loadingStatus.style.display = 'none';
            loadedRaces.style.display = 'block';
            raceCount.textContent = `${loadedCount}„É¨„Éº„ÇπË™≠„ÅøËæº„ÅøÂÆå‰∫Ü`;
            racesList.innerHTML = loadedRaceNames.map(name => 
                `<span style="background:#e8f5e8; padding:3px 8px; margin:2px; border-radius:12px; font-size:0.8rem;">${name}</span>`
            ).join(' ');
            
            if (loadedCount === 0) {
                racesList.innerHTML = '<span style="color:#e74c3c;">Ë™≠„ÅøËæº„ÇÅ„Çã„É¨„Éº„Çπ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>';
                raceCount.textContent = '0„É¨„Éº„Çπ';
            }
        }
        
        // Êï∞ÂÄ§„ÅÆÈ´ò‰ΩéÂà§ÂÆöË®≠ÂÆö
        const valueTypes = {
            'popularity': 'lower', // ‰∫∫Ê∞ó„ÅØ‰Ωé„ÅÑÊñπ„ÅåËâØ„ÅÑ
            '‰∏ä„Çä3FÂπ≥Âùá': 'lower',
            'Ave-3FÂπ≥Âùá': 'lower',
            '-3FÂ∑ÆÂπ≥Âùá': 'zero', // 0„Å´Ëøë„ÅÑÊñπ„ÅåËâØ„ÅÑÔºàÂâç„ÇíËµ∞„ÇãÔºâ
            'PCIÂπ≥Âùá': 'distance_from_50', // 50„Åã„Çâ„ÅÆË∑ùÈõ¢„ÅßËÑöË≥™Âà§ÂÆö
            'track_aptitude': 'higher',
            'score_original': 'higher',
            'score_z': 'higher',
            'pred_prob_won': 'higher',
            'pred_prob_in_top2': 'higher',
            'pred_prob_in_top3': 'higher',
            'track_bias_aptitude_score': 'higher',
            'investment_value_score': 'higher',
            'total_investment_index': 'higher',
            'investment_rating': 'higher' // ÊäïË≥á‰æ°ÂÄ§„ÅÆÈáçË¶ÅÊåáÊ®ô
        };
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'cards') {
                document.getElementById('cardView').style.display = 'grid';
                document.getElementById('tableView').style.display = 'none';
            } else {
                document.getElementById('cardView').style.display = 'none';
                document.getElementById('tableView').style.display = 'block';
                renderTable();
            }
        }
        
        function formatValue(value, key) {
            if (value === null || value === undefined) return '-';
            if (typeof value === 'number') {
                if (key.includes('prob_')) return (value * 100).toFixed(1) + '%';
                if (key === 'PCIÂπ≥Âùá') {
                    const pciType = value < 45 ? 'ÂâçÂçäÂûã' : value > 55 ? 'ÂæåÂçäÂûã' : 'ÊåÅ‰πÖÂûã';
                    return `${value.toFixed(1)} (${pciType})`;
                }
                if (key === '-3FÂ∑ÆÂπ≥Âùá') {
                    const position = Math.abs(value) < 0.5 ? 'ÂâçÂØÑ„Çä' : '‰∏≠ÂæåÊñπ';
                    return `${value.toFixed(2)} (${position})`;
                }
                if (key === 'investment_rating') {
                    const rating = value > 0.7 ? 'È´ò' : value > 0.4 ? '‰∏≠' : '‰Ωé';
                    return `${value.toFixed(3)} (${rating})`;
                }
                return value.toFixed(2);
            }
            return value;
        }
        
        function renderCards() {
            const horses = getFilteredHorses();
            const cardView = document.getElementById('cardView');
            
            cardView.innerHTML = horses.map(horse => `
                <div class="horse-card">
                    <div class="horse-header">
                        <div class="horse-name">${horse.name}</div>
                        <div class="horse-number">${horse.horse_number}</div>
                    </div>
                    <div class="mark-section">
                        <div class="mark final-mark">Êú¨ÂëΩ: ${horse.final_mark}</div>
                        <div class="mark investment-mark">ÊäïË≥á: ${horse.investment_mark}</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">‰∫∫Ê∞ó</div>
                            <div class="stat-value">${horse.popularity || '-'}‰Ωç</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">„Çπ„Ç≥„Ç¢</div>
                            <div class="stat-value">${formatValue(horse.score_original)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÂãùÁéá‰∫àÊ∏¨</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">3ÁùÄÂÜÖÁéá</div>
                            <div class="stat-value">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">‰∏ä„Çä3F</div>
                            <div class="stat-value">${formatValue(horse['‰∏ä„Çä3FÂπ≥Âùá'])}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">-3FÂ∑Æ (‰ΩçÁΩÆ)</div>
                            <div class="stat-value">${formatValue(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">PCI (ËÑöË≥™)</div>
                            <div class="stat-value">${formatValue(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÈÅ©ÊÄß„Çπ„Ç≥„Ç¢</div>
                            <div class="stat-value">${formatValue(horse.track_bias_aptitude_score)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÊäïË≥áË©ï‰æ°‚òÖ</div>
                            <div class="stat-value">${formatValue(horse.investment_rating, 'investment_rating')}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderTable() {
            const horses = getFilteredHorses();
            const tableView = document.getElementById('tableView');
            
            const numericKeys = Object.keys(horses[0]).filter(key => 
                typeof horses[0][key] === 'number' && key !== 'horse_number'
            );
            
            // ÂêÑÂàó„ÅÆÊúÄÈ´òÂÄ§„ÉªÊúÄ‰ΩéÂÄ§„ÇíË®àÁÆó
            const stats = {};
            numericKeys.forEach(key => {
                const values = horses.map(h => h[key]).filter(v => v !== null && v !== undefined);
                if (values.length > 0) {
                    stats[key] = {
                        min: Math.min(...values),
                        max: Math.max(...values)
                    };
                }
            });
            
            function getCellClass(value, key) {
                if (!stats[key] || value === null || value === undefined) return '';
                
                if (valueTypes[key] === 'higher') {
                    return value === stats[key].max ? 'best-value' : 
                           value === stats[key].min ? 'worst-value' : '';
                } else if (valueTypes[key] === 'lower') {
                    return value === stats[key].min ? 'best-value' : 
                           value === stats[key].max ? 'worst-value' : '';
                } else if (valueTypes[key] === 'zero') {
                    // 0„Å´ÊúÄ„ÇÇËøë„ÅÑÂÄ§„ÅåÊúÄËâØ
                    const distances = horses.map(h => Math.abs(h[key] || 0)).filter(d => !isNaN(d));
                    const minDistance = Math.min(...distances);
                    return Math.abs(value) === minDistance ? 'best-value' : '';
                } else if (valueTypes[key] === 'distance_from_50') {
                    // PCIÂπ≥Âùá„ÅØ50„Åã„Çâ„ÅÆË∑ùÈõ¢„ÅßËÑöË≥™„ÇíÁ§∫„Åô„ÅÆ„Åß„ÄÅÊúÄËâØ/ÊúÄÊÇ™„ÅÆÊ¶ÇÂøµ„ÅØÈÅ©Áî®„Åó„Å™„ÅÑ
                    return '';
                }
                return '';
            }
            
            tableView.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>È¶¨Áï™</th>
                            <th>È¶¨Âêç</th>
                            <th>‰∫∫Ê∞ó</th>
                            <th>Êú¨ÂëΩÂç∞</th>
                            <th>ÊäïË≥áÂç∞</th>
                            <th>„Çπ„Ç≥„Ç¢</th>
                            <th>ÂãùÁéá‰∫àÊ∏¨</th>
                            <th>3ÁùÄÂÜÖÁéá</th>
                            <th>‰∏ä„Çä3F</th>
                            <th>Ave-3F</th>
                            <th>-3FÂ∑Æ</th>
                            <th>PCI(ËÑöË≥™)</th>
                            <th>ÈÅ©ÊÄß„Çπ„Ç≥„Ç¢</th>
                            <th>ÊäïË≥áË©ï‰æ°‚òÖ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${horses.map(horse => `
                            <tr>
                                <td>${horse.horse_number}</td>
                                <td><strong>${horse.name}</strong></td>
                                <td class="${getCellClass(horse.popularity, 'popularity')}">${horse.popularity || '-'}</td>
                                <td>${horse.final_mark}</td>
                                <td>${horse.investment_mark}</td>
                                <td class="${getCellClass(horse.score_original, 'score_original')}">${formatValue(horse.score_original)}</td>
                                <td class="${getCellClass(horse.pred_prob_won, 'pred_prob_won')}">${formatValue(horse.pred_prob_won, 'pred_prob_won')}</td>
                                <td class="${getCellClass(horse.pred_prob_in_top3, 'pred_prob_in_top3')}">${formatValue(horse.pred_prob_in_top3, 'pred_prob_in_top3')}</td>
                                <td class="${getCellClass(horse['‰∏ä„Çä3FÂπ≥Âùá'], '‰∏ä„Çä3FÂπ≥Âùá')}">${formatValue(horse['‰∏ä„Çä3FÂπ≥Âùá'])}</td>
                                <td class="${getCellClass(horse['Ave-3FÂπ≥Âùá'], 'Ave-3FÂπ≥Âùá')}">${formatValue(horse['Ave-3FÂπ≥Âùá'])}</td>
                                <td class="${getCellClass(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}">${formatValue(horse['-3FÂ∑ÆÂπ≥Âùá'], '-3FÂ∑ÆÂπ≥Âùá')}</td>
                                <td class="${getCellClass(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}">${formatValue(horse['PCIÂπ≥Âùá'], 'PCIÂπ≥Âùá')}</td>
                                <td class="${getCellClass(horse.track_bias_aptitude_score, 'track_bias_aptitude_score')}">${formatValue(horse.track_bias_aptitude_score)}</td>
                                <td class="${getCellClass(horse.investment_rating, 'investment_rating')}">${formatValue(horse.investment_rating, 'investment_rating')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function getFilteredHorses() {
            let horses = [...raceData[currentRace].horses];
            
            // „ÇΩ„Éº„Éà
            const sortBy = document.getElementById('sortBy').value;
            horses.sort((a, b) => {
                const aVal = a[sortBy] || 0;
                const bVal = b[sortBy] || 0;
                
                if (valueTypes[sortBy] === 'lower') {
                    return aVal - bVal;
                } else if (valueTypes[sortBy] === 'zero') {
                    return Math.abs(aVal) - Math.abs(bVal);
                } else {
                    return bVal - aVal; // higher
                }
            });
            
            // „Éï„Ç£„É´„Çø„Éº
            const filterBy = document.getElementById('filterBy').value;
            if (filterBy === 'top3') {
                horses = horses.filter(h => h.popularity <= 3);
            } else if (filterBy === 'mark_good') {
                horses = horses.filter(h => ['‚óé', '‚óã'].includes(h.final_mark));
            } else if (filterBy === 'investment_good') {
                horses = horses.filter(h => h.investment_rating > 0.5);
            }
            
            // Ê§úÁ¥¢
            const searchTerm = document.getElementById('searchHorse').value.toLowerCase();
            if (searchTerm) {
                horses = horses.filter(h => h.name.toLowerCase().includes(searchTerm));
            }
            
            return horses;
        }
        
        function setupEventListeners() {
            document.getElementById('sortBy').addEventListener('change', renderCurrentView);
            document.getElementById('filterBy').addEventListener('change', renderCurrentView);
            document.getElementById('searchHorse').addEventListener('input', renderCurrentView);
            document.getElementById('raceSelect').addEventListener('change', function() {
                const selectedRace = this.value;
                if (selectedRace && raceData[selectedRace]) {
                    currentRace = selectedRace;
                    renderCurrentView();
                }
            });
        }
        
        function renderCurrentView() {
            if (!currentRace || !raceData[currentRace]) return;
            
            if (currentView === 'cards') {
                renderCards();
            } else {
                renderTable();
            }
        }
        
        // ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', async () => {
            setupEventListeners();
            await loadRaceData();
        });
    </script>
</body>
</html>
